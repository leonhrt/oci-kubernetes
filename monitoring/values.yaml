# VictoriaMetrics K8s Stack Configuration

# VictoriaMetrics Single Node (storage)
vmsingle:
  enabled: true
  spec:
    retentionPeriod: "14d"
    resources:
      requests:
        cpu: 50m
        memory: 256Mi
      limits:
        memory: 512Mi
    storage:
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 10Gi

# VMAgent - scrapes metrics and writes to vmsingle
vmagent:
  enabled: true
  spec:
    resources:
      requests:
        cpu: 50m
        memory: 128Mi
      limits:
        memory: 256Mi

# Grafana
grafana:
  enabled: true
  persistence:
    enabled: false
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      memory: 256Mi
  # Default admin credentials - change or use external secret
  admin:
    existingSecret: ""

  envFromSecrets:
    - name: grafana-client-secret

  grafana.ini:
    server:
      root_url: https://grafana.leonhrt.com
    auth:
      disable_login_form: true
    auth.google:
      enabled: true
      allow_sign_up: true
      auto_login: false
      client_id: $__env{clientID}
      client_secret: $__env{clientSecret}
      scopes: openid email profile
      auth_url: https://accounts.google.com/o/oauth2/v2/auth
      token_url: https://oauth2.googleapis.com/token
      api_url: https://openidconnect.googleapis.com/v1/userinfo
      allowed_domains: leonhrt.com
      role_attribute_path: email=='sre@leonhrt.com' && 'Admin' || 'Viewer'

# Alertmanager - disabled for now
alertmanager:
  enabled: false

# VMAlert - disabled for now (no alerting rules)
vmalert:
  enabled: false

# Prometheus Node Exporter (host metrics)
prometheus-node-exporter:
  enabled: true
  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      memory: 64Mi

# Kube State Metrics (kubernetes object metrics)
kube-state-metrics:
  enabled: true
  resources:
    requests:
      cpu: 10m
      memory: 64Mi
    limits:
      memory: 128Mi

# Prometheus Operator CRDs - not needed for VM stack
prometheus-operator-crds:
  enabled: false

# Default dashboards
defaultDashboardsEnabled: true
experimentalDashboardsEnabled: false

# ServiceMonitor for kubelet metrics
kubelet:
  enabled: true

# ServiceMonitor for API server
kubeApiServer:
  enabled: true

# ServiceMonitor for kube-controller-manager
kubeControllerManager:
  enabled: true

# ServiceMonitor for kube-scheduler
kubeScheduler:
  enabled: true

# ServiceMonitor for etcd
kubeEtcd:
  enabled: true

# ServiceMonitor for CoreDNS
coreDns:
  enabled: true
